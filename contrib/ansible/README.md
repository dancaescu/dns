# MyDNS Ansible Playbooks

**Auto-generated on 2025-11-28 23:24:29**

This directory contains Ansible playbooks for deploying and managing MyDNS infrastructure.
These playbooks are **automatically generated** from the `contrib/` directory by the
`generate_ansible.py` script.

## ⚠️ Important

**DO NOT manually edit files in this directory!**

All changes should be made in the source files in `contrib/`, then regenerate by running:

```bash
cd /scripts/mydns-ng-master/contrib
python3 generate_ansible.py
```

## Available Playbooks

### 1. MyDNS Server (`mydns-server.yml`)
Installs and configures MyDNS authoritative DNS server with:
- GeoIP support
- DNS over HTTPS (DoH)
- DNS caching
- Memzone for AXFR slaves
- DNSSEC support

**Usage:**
```bash
ansible-playbook -i inventory mydns-server.yml
```

### 2. Web UI (`webui.yml`)
Installs the DNS Manager web interface with:
- Node.js backend API
- React frontend
- nginx reverse proxy
- PM2 process manager

**Usage:**
```bash
ansible-playbook -i inventory webui.yml
```

### 3. GeoIP Sensor (`sensor.yml`)
Installs GeoIP sensors for distributed load balancing

**Usage:**
```bash
ansible-playbook -i inventory sensor.yml
```

### 4. Cloudflare Sync (`cloudflare-sync.yml`)
Sets up cron job for multi-user Cloudflare zone synchronization

**Usage:**
```bash
ansible-playbook -i inventory cloudflare-sync.yml
```

### 5. Database Schemas (`database-schemas.yml`)
Applies all SQL schemas from contrib/:
- DoH configuration
- User Cloudflare credentials
- Zone ACLs
- DNSSEC keys
- And more...

**Usage:**
```bash
ansible-playbook -i inventory database-schemas.yml
```

## Quick Start

1. Copy the example inventory:
   ```bash
   cp inventory.example inventory
   ```

2. Edit inventory with your servers:
   ```bash
   vi inventory
   ```

3. Run a playbook:
   ```bash
   ansible-playbook -i inventory mydns-server.yml
   ```

## Tags

Use tags to run specific parts of playbooks:

```bash
# Only install dependencies
ansible-playbook -i inventory mydns-server.yml --tags dependencies

# Only configure and restart service
ansible-playbook -i inventory mydns-server.yml --tags config,service

# Skip building from source
ansible-playbook -i inventory mydns-server.yml --skip-tags build
```

## Variables

Override default variables in `group_vars/all.yml` or on command line:

```bash
ansible-playbook -i inventory mydns-server.yml -e "mydns_port=5353 geoip_enabled=false"
```

## Requirements

- Ansible 2.9+
- Python 3.7+
- SSH access to target servers
- sudo/root privileges on target servers

## Regenerating Playbooks

After updating contrib/ files:

```bash
cd /scripts/mydns-ng-master/contrib
python3 generate_ansible.py
```

This will regenerate all playbooks in `ansible/`.

## License

GPLv2 - See LICENSE file

## Generated By

`generate_ansible.py` - Automatic Ansible recipe generator for MyDNS
