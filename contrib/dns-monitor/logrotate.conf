# Logrotate configuration for DNS monitoring logs
# Install to: /etc/logrotate.d/dns-monitor
#
# Installation:
#   sudo cp logrotate.conf /etc/logrotate.d/dns-monitor
#
# Test:
#   sudo logrotate -d /etc/logrotate.d/dns-monitor
#
# Force rotation:
#   sudo logrotate -f /etc/logrotate.d/dns-monitor

/var/log/dns-monitor/queries.log {
    # Rotate every hour
    hourly

    # Keep only last 24 hours (24 rotations)
    rotate 24

    # Compress old logs
    compress
    delaycompress

    # Don't error if log is missing
    missingok

    # Don't rotate if empty
    notifempty

    # Create new log with these permissions
    create 0640 root root

    # Truncate instead of moving (faster for high-volume)
    copytruncate

    # Rotate if size exceeds 100MB even if not hourly yet
    size 100M

    # Post-rotation script
    postrotate
        # Send HUP signal to tcpdump if running
        pkill -HUP -f "dns-monitor-tcpdump.sh" 2>/dev/null || true
    endscript
}

/var/log/dns-monitor/alerts.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    copytruncate

    # Keep alerts longer since they're smaller
    maxage 7
}

/var/log/dns-monitor/stats.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    copytruncate
    maxage 7
}

# DNS attack blocker logs
/var/log/dns-monitor/blocked-ips.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    copytruncate
}
